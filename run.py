from sklearn.ensemble import RandomForestClassifier
from sklearn.model_selection import train_test_split
from ngrams import k1_most_frequent_Ngrams

from preprocess import generate_dataset, get_list_of_samples

directories_with_labels = [("Normal PE",0), ("Malicious PE", 1)]
list_of_samples, labels = get_list_of_samples(directories_with_labels)

# split to 33% test
samples_train, samples_test, labels_train, labels_test = train_test_split(
    list_of_samples, labels, test_size=0.3, stratify=labels,
    random_state=11
)

K1_most_frequent_Ngrams_list = k1_most_frequent_Ngrams(samples_train)
X_train, y_train = generate_dataset(samples_train, labels_train, K1_most_frequent_Ngrams_list)

# start traning
clf = RandomForestClassifier(n_estimators=100)
clf = clf.fit(X_train, y_train)

# start testing
X_test, y_test = generate_dataset(samples_test, labels_test, K1_most_frequent_Ngrams_list)
print(clf.score(X_test, y_test))